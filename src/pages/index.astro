---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPages = await getCollection('pages');
const indexPage = allPages.find((p) => p.slug === 'index');
const { Content } = indexPage ? await indexPage.render() : { Content: null };

const heroTitle = indexPage?.data.title || 'My Name Is PIN HAO';
const browserTitle = 'MNIPH';
const description = indexPage?.data.description;
const heading = indexPage?.data.heading || '';
const heroImageLight = indexPage?.data.heroImageLight ?? indexPage?.data.image;
const heroImageDark = indexPage?.data.heroImageDark ?? null;
const heroImageAlt = indexPage?.data.heroImageAlt || heroTitle;
const hasHeroImage = heroImageLight || heroImageDark;
---

<Layout title={browserTitle} description={description}>
	<section class="home-hero">
		{heroTitle && <p class="home-hero__label">{heroTitle}</p>}
		{heading && <h1 class="home-hero__heading">{heading}</h1>}
	{hasHeroImage && (
		<figure class="home-hero__image">
			{heroImageLight && (
				<img
					src={heroImageLight}
					alt={heroImageAlt}
					class="home-hero__img home-hero__img--light"
					loading="eager"
					decoding="async"
				/>
			)}
			{heroImageDark && (
				<img
					src={heroImageDark}
					alt={heroImageAlt}
					class="home-hero__img home-hero__img--dark"
					loading="eager"
					decoding="async"
				/>
			)}
		</figure>
	)}
	{Content && (
		<article class="home-hero__body post-content no-image">
			<Content />
		</article>
		)}
	</section>
</Layout>

<style>
	.home-hero {
		max-width: 860px;
		margin: 0 auto;
		padding: 1.5rem;
		text-align: center;
	}

	.home-hero__label {
		font-variant: small-caps;
		letter-spacing: 0.2em;
		margin: 0 0 0.5rem;
		color: var(--color-border);
	}

	.home-hero__heading {
		font-size: clamp(2.5rem, 6vw, 4.5rem);
		margin: 0;
		font-family: var(--font-sans-serif);
	}

	.home-hero__body {
		margin-top: 2rem;
	}

	.home-hero__body :global(h2) {
		font-size: clamp(2rem, 4vw, 3rem);
	}

	.home-hero__image {
		margin-top: 2rem;
	}

	.home-hero__img {
		display: block;
		width: 100%;
		border-radius: 10px;
		border: 1px solid var(--color-border);
	}

	.home-hero__img + .home-hero__img {
		margin-top: 1rem;
	}
	</style>

<style is:global>
	html:not([data-theme='dark']) .home-hero__img--light {
		display: block;
	}

	html:not([data-theme='dark']) .home-hero__img--dark {
		display: none;
	}

	html[data-theme='dark'] .home-hero__img--light {
		display: none;
	}

	html[data-theme='dark'] .home-hero__img--dark {
		display: block;
	}
</style>
